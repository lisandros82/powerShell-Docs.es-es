---
ms.date: 2017-06-12
author: rpsqrd
ms.topic: conceptual
keywords: jea,powershell,security
title: Consideraciones de seguridad de JEA
ms.openlocfilehash: 2dcce34113998a1c31709b6afe6d0a21c991e79d
ms.sourcegitcommit: f069ff0689006fece768f178c10e3e3eeaee09f0
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/13/2017
---
# <a name="jea-security-considerations"></a><span data-ttu-id="ad81c-103">Consideraciones de seguridad de JEA</span><span class="sxs-lookup"><span data-stu-id="ad81c-103">JEA Security Considerations</span></span>

> <span data-ttu-id="ad81c-104">Se aplica a: Windows PowerShell 5.0</span><span class="sxs-lookup"><span data-stu-id="ad81c-104">Applies to: Windows PowerShell 5.0</span></span>

<span data-ttu-id="ad81c-105">JEA le ayuda a mejorar su posición en materia de seguridad, ya que reduce el número de administradores permanentes de sus equipos.</span><span class="sxs-lookup"><span data-stu-id="ad81c-105">JEA helps you improve your security posture by reducing the number of permanent administrators on your machines.</span></span>
<span data-ttu-id="ad81c-106">Lo hace mediante la creación de un nuevo punto de entrada para que los usuarios administren el sistema (una configuración de sesión de PowerShell) que, además, está bien bloqueado de manera predeterminada para evitar el uso indebido.</span><span class="sxs-lookup"><span data-stu-id="ad81c-106">It does so by creating a new entry point for users to manage the system (a PowerShell session configuration) which is tightly locked down by default to prevent misuse.</span></span>
<span data-ttu-id="ad81c-107">A los usuarios que necesitan algún acceso, pero no ilimitado, al equipo para realizar tareas administrativas se les puede conceder acceso al punto de conexión de JEA.</span><span class="sxs-lookup"><span data-stu-id="ad81c-107">Users who need some, but not unlimited, access to the machine to perform administrative tasks can be granted access to the JEA endpoint.</span></span>
<span data-ttu-id="ad81c-108">Como JEA les permite ejecutar comandos de administrador sin tener directamente acceso de administrador, después puede quitar a dichos usuarios de grupos de seguridad con privilegios elevados, es decir, convertirlos en usuarios estándar.</span><span class="sxs-lookup"><span data-stu-id="ad81c-108">Because JEA allows them to run admin commands without directly having admin access, you can then remove those users from highly privileged security groups (make them standard users).</span></span>

<span data-ttu-id="ad81c-109">En este tema, se describen el modelo de seguridad de JEA y los procedimientos recomendados con más detalle.</span><span class="sxs-lookup"><span data-stu-id="ad81c-109">This topic describes the JEA security model and best practices in more detail.</span></span>

## <a name="run-as-account"></a><span data-ttu-id="ad81c-110">cuenta de identificación</span><span class="sxs-lookup"><span data-stu-id="ad81c-110">Run As account</span></span>

<span data-ttu-id="ad81c-111">Cada punto de conexión de JEA tiene una cuenta de "ejecución" designada, que es la cuenta en la que se realizan las acciones del usuario que se conecta.</span><span class="sxs-lookup"><span data-stu-id="ad81c-111">Each JEA endpoint has a designated "run as" account, which is the account under which the connecting user's actions are performed.</span></span>
<span data-ttu-id="ad81c-112">Esta cuenta se puede configurar en el [archivo de configuración de sesión](session-configurations.md), y la cuenta que elija influye de forma significativa en la seguridad del punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="ad81c-112">This account is configurable in the [session configuration file](session-configurations.md), and the account you choose has a significant bearing on the security of your endpoint.</span></span>

<span data-ttu-id="ad81c-113">Las **cuentas virtuales** son la forma recomendada de configurar la cuenta de ejecución.</span><span class="sxs-lookup"><span data-stu-id="ad81c-113">**Virtual accounts** are the recommended way of configuring the run as account.</span></span>
<span data-ttu-id="ad81c-114">Las cuentas virtuales son cuentas locales únicas y temporales creadas por el usuario que se conecta para usarlas durante la sesión de JEA.</span><span class="sxs-lookup"><span data-stu-id="ad81c-114">Virtual accounts are one-time, temporary local accounts that are created for the connecting user to use during the duration of their JEA session.</span></span>
<span data-ttu-id="ad81c-115">Una vez finalizada la sesión, la cuenta virtual se destruirá y no se podrá volver a usar.</span><span class="sxs-lookup"><span data-stu-id="ad81c-115">As soon as their session is terminated, the virtual account will be destroyed and cannot be used anymore.</span></span>
<span data-ttu-id="ad81c-116">El usuario que se conecta no conoce las credenciales de la cuenta virtual y no puede usarla para tener acceso al sistema por otros medios, como el Escritorio remoto o un punto de conexión de PowerShell sin restricciones.</span><span class="sxs-lookup"><span data-stu-id="ad81c-116">The connecting user does not know the credentials for the virtual account and cannot use the virtual account to access the system via other means, such as Remote Desktop or an unconstrained PowerShell endpoint.</span></span>

<span data-ttu-id="ad81c-117">De manera predeterminada, las cuentas virtuales pertenecen al grupo de administradores locales del equipo.</span><span class="sxs-lookup"><span data-stu-id="ad81c-117">By default, virtual accounts belong to the local administrators group on the machine.</span></span>
<span data-ttu-id="ad81c-118">Esto les otorga derechos completos para administrar todo en el sistema, pero no les otorga ningún derecho para administrar recursos de la red.</span><span class="sxs-lookup"><span data-stu-id="ad81c-118">This gives them full rights to manage anything on the system, but no rights to manage resources on the network.</span></span>
<span data-ttu-id="ad81c-119">Para la autenticación con otros equipos, el contexto de usuario será el de la cuenta de equipo local, no la cuenta virtual.</span><span class="sxs-lookup"><span data-stu-id="ad81c-119">When authenticating with other machines, the user context will be that of the local computer account, not the virtual account.</span></span>

<span data-ttu-id="ad81c-120">Los controladores de dominio son un caso especial porque no hay ningún concepto de un grupo de administradores local.</span><span class="sxs-lookup"><span data-stu-id="ad81c-120">Domain controllers are a special case since there is no concept of a local administrators group.</span></span>
<span data-ttu-id="ad81c-121">En su lugar, las cuentas virtuales pertenecen a administradores de dominio y pueden administrar los servicios de directorio en el controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="ad81c-121">Instead, virtual accounts belong to Domain Admins instead and can manage the directory services on the domain controller.</span></span>
<span data-ttu-id="ad81c-122">La identidad de dominio se limita a utilizarse en el controlador de dominio donde se creó una instancia de la sesión JEA, y cualquier acceso a la red parecerá provenir del objeto de equipo del controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="ad81c-122">The domain identity is still restricted to use on the domain controller where the JEA session was instantiated, and any network access will appear to come from the domain controller computer object instead.</span></span>

<span data-ttu-id="ad81c-123">En ambos casos, también puede definir de forma explícita los grupos de seguridad a los que debe pertenecer la cuenta virtual.</span><span class="sxs-lookup"><span data-stu-id="ad81c-123">In both cases, you can also explicitly define which security groups the virtual account should belong to.</span></span>
<span data-ttu-id="ad81c-124">Este es un procedimiento recomendado cuando la tarea que está realizando puede llevarse a cabo sin privilegios de administrador local o de dominio.</span><span class="sxs-lookup"><span data-stu-id="ad81c-124">This is a good practice when the task you are performing can be done without local/domain admin privileges.</span></span>
<span data-ttu-id="ad81c-125">Si ya tiene un grupo de seguridad definido para los administradores, simplemente puede conceder la pertenencia a la cuenta virtual a ese grupo para otorgarle los permisos que necesita.</span><span class="sxs-lookup"><span data-stu-id="ad81c-125">If you already have a security group defined for your admins, you can simply grant the virtual account membership to that group to give it the permissions it needs.</span></span>
<span data-ttu-id="ad81c-126">La pertenencia al grupo de cuenta virtual se limita a los grupos de seguridad locales en servidores miembro y estaciones de trabajo, pero en un controlador de dominio solo pueden ser miembros de grupos de seguridad de dominio.</span><span class="sxs-lookup"><span data-stu-id="ad81c-126">Virtual account group membership is limited to local security groups on workstation and member servers, but on a domain controller they can only be members of domain security groups.</span></span>
<span data-ttu-id="ad81c-127">Después de especificar uno o varios grupos de seguridad para que la cuenta virtual pertenezca a ellos, dejará de pertenecer a los grupos predeterminados (administrador local o administrador de dominio).</span><span class="sxs-lookup"><span data-stu-id="ad81c-127">Once you specify one or more security groups for the virtual account to belong to, it will no longer belong to the default groups (local admin or domain admin).</span></span>

<span data-ttu-id="ad81c-128">En la tabla siguiente, se resumen las posibles opciones de configuración y los permisos resultantes de las cuentas virtuales.</span><span class="sxs-lookup"><span data-stu-id="ad81c-128">The table below summarizes the possible configuration options and resulting permissions for virtual accounts</span></span>

<span data-ttu-id="ad81c-129">Tipo de equipo</span><span class="sxs-lookup"><span data-stu-id="ad81c-129">Computer type</span></span>                | <span data-ttu-id="ad81c-130">Configuración del grupo de cuenta virtual</span><span class="sxs-lookup"><span data-stu-id="ad81c-130">Virtual account group configuration</span></span> | <span data-ttu-id="ad81c-131">Contexto de usuario local</span><span class="sxs-lookup"><span data-stu-id="ad81c-131">Local user context</span></span>                                      | <span data-ttu-id="ad81c-132">Contexto de usuario de red</span><span class="sxs-lookup"><span data-stu-id="ad81c-132">Network user context</span></span>
-----------------------------|-------------------------------------|---------------------------------------------------------|--------------------------------------------------
<span data-ttu-id="ad81c-133">Controlador de dominio</span><span class="sxs-lookup"><span data-stu-id="ad81c-133">Domain controller</span></span>            | <span data-ttu-id="ad81c-134">Valor predeterminado</span><span class="sxs-lookup"><span data-stu-id="ad81c-134">Default</span></span>                             | <span data-ttu-id="ad81c-135">Usuario de dominio, miembro de "*DOMINIO*\Administradores de domino"</span><span class="sxs-lookup"><span data-stu-id="ad81c-135">Domain user, member of '*DOMAIN*\Domain Admins'</span></span>         | <span data-ttu-id="ad81c-136">Cuenta de equipo</span><span class="sxs-lookup"><span data-stu-id="ad81c-136">Computer account</span></span>
<span data-ttu-id="ad81c-137">Controlador de dominio</span><span class="sxs-lookup"><span data-stu-id="ad81c-137">Domain controller</span></span>            | <span data-ttu-id="ad81c-138">Grupos de dominio A y B</span><span class="sxs-lookup"><span data-stu-id="ad81c-138">Domain groups A and B</span></span>               | <span data-ttu-id="ad81c-139">Usuario de dominio, miembro de "*DOMINIO*\A", "*DOMINIO*\B"</span><span class="sxs-lookup"><span data-stu-id="ad81c-139">Domain user, member of '*DOMAIN*\A', '*DOMAIN*\B'</span></span>       | <span data-ttu-id="ad81c-140">Cuenta de equipo</span><span class="sxs-lookup"><span data-stu-id="ad81c-140">Computer account</span></span>
<span data-ttu-id="ad81c-141">Servidor miembro o estación de trabajo</span><span class="sxs-lookup"><span data-stu-id="ad81c-141">Member server or workstation</span></span> | <span data-ttu-id="ad81c-142">Valor predeterminado</span><span class="sxs-lookup"><span data-stu-id="ad81c-142">Default</span></span>                             | <span data-ttu-id="ad81c-143">Usuario local, miembro de "*BUILTIN*\Administradores"</span><span class="sxs-lookup"><span data-stu-id="ad81c-143">Local user, member of '*BUILTIN*\Administrators'</span></span>        | <span data-ttu-id="ad81c-144">Cuenta de equipo</span><span class="sxs-lookup"><span data-stu-id="ad81c-144">Computer account</span></span>
<span data-ttu-id="ad81c-145">Servidor miembro o estación de trabajo</span><span class="sxs-lookup"><span data-stu-id="ad81c-145">Member server or workstation</span></span> | <span data-ttu-id="ad81c-146">Grupos locales C y D</span><span class="sxs-lookup"><span data-stu-id="ad81c-146">Local groups C and D</span></span>                | <span data-ttu-id="ad81c-147">Usuario local, miembro de "*EQUIPO*\C" y "*EQUIPO*\D"</span><span class="sxs-lookup"><span data-stu-id="ad81c-147">Local user, member of '*COMPUTER*\C' and '*COMPUTER*\D'</span></span> | <span data-ttu-id="ad81c-148">Cuenta de equipo</span><span class="sxs-lookup"><span data-stu-id="ad81c-148">Computer account</span></span>

<span data-ttu-id="ad81c-149">Al examinar los eventos de auditoría de seguridad y los registros de eventos de la aplicación, verá que cada sesión de usuario de JEA tiene una cuenta virtual única.</span><span class="sxs-lookup"><span data-stu-id="ad81c-149">When you look at security audit events and application event logs, you will see that each JEA user session has a unique virtual account.</span></span>
<span data-ttu-id="ad81c-150">Esto le ayuda a realizar un seguimiento de las acciones del usuario en un punto de conexión de JEA hasta el usuario original que ha ejecutado el comando.</span><span class="sxs-lookup"><span data-stu-id="ad81c-150">This helps you track user actions in a JEA endpoint back to the original user who ran the command.</span></span>
<span data-ttu-id="ad81c-151">Los nombres de cuenta virtual siguen el formato "Usuarios virtuales WinRM\\WinRM\_CUENTAVIRTUAL\_*NÚMEROCUENTA*\_*DOMINIO*\_*NombreCuentaSAM*". Por ejemplo, si el usuario "Alice" del dominio "Contoso" reinicia un servicio en un punto de conexión de JEA, el nombre de usuario asociado con todos los eventos del administrador de control de servicio sería "Usuarios virtuales WinRM\\WinRM\_CUENTAVIRTUAL\_1\_contoso\_alice".</span><span class="sxs-lookup"><span data-stu-id="ad81c-151">Virtual account names follow the format "WinRM Virtual Users\\WinRM\_VA\_*ACCOUNTNUMBER*\_*DOMAIN*\_*sAMAccountName*" For example, if user "Alice" in domain "Contoso" restarts a service in a JEA endpoint, the username associated with any service control manager events would be "WinRM Virtual Users\\WinRM\_VA\_1\_contoso\_alice".</span></span>


<span data-ttu-id="ad81c-152">Las **cuentas de servicio administradas de grupo (gMSA)** son útiles cuando un servidor miembro necesita tener acceso a recursos de red en la sesión de JEA.</span><span class="sxs-lookup"><span data-stu-id="ad81c-152">**Group managed service accounts (gMSAs)** are useful when a member server needs to have access to network resources in the JEA session.</span></span>
<span data-ttu-id="ad81c-153">Un caso de uso de ejemplo es un punto de conexión de JEA que se usa para controlar el acceso a una API de REST hospedada en un equipo diferente.</span><span class="sxs-lookup"><span data-stu-id="ad81c-153">An example use case for this is a JEA endpoint that is used to control access to a REST API hosted on a different machine.</span></span>
<span data-ttu-id="ad81c-154">Es fácil escribir funciones para realizar las invocaciones que quiera en la API de REST, pero para autenticarse en la API se necesita una identidad de red.</span><span class="sxs-lookup"><span data-stu-id="ad81c-154">It is easy to write functions to make the desired invocations on the REST API, but in order to authenticate with the API you need a network identity.</span></span>
<span data-ttu-id="ad81c-155">Mediante una cuenta de servicio administrada de grupo, el "segundo salto" es posible mientras se conserva el control sobre los equipos que pueden usar la cuenta.</span><span class="sxs-lookup"><span data-stu-id="ad81c-155">Using a group managed service account makes the "second hop" possible while still having control over which computers can use the account.</span></span>
<span data-ttu-id="ad81c-156">Los permisos efectivos de la gMSA se definen mediante los grupos de seguridad, ya sean locales o de dominio, a los que pertenece la cuenta gMSA.</span><span class="sxs-lookup"><span data-stu-id="ad81c-156">The effective permissions of the gMSA are defined by the security groups (local or domain) to which the gMSA account belongs.</span></span>

<span data-ttu-id="ad81c-157">Cuando un punto de conexión de JEA se configura para usar una cuenta gMSA, parecerá que las acciones de todos los usuarios de JEA vienen de la misma cuenta de servicio administrada de grupo.</span><span class="sxs-lookup"><span data-stu-id="ad81c-157">When a JEA endpoint is configured to use a gMSA account, the actions of all JEA users will appear to come from the same group managed service account.</span></span>
<span data-ttu-id="ad81c-158">La única manera de realizar un seguimiento de las acciones hasta un usuario específico es identificar el conjunto de comandos que se ejecutan en una transcripción de la sesión de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ad81c-158">The only way you can trace actions back to a specific user is to identify the set of commands run in a PowerShell session transcript.</span></span>

<span data-ttu-id="ad81c-159">Las **credenciales de paso a través** se usan cuando no especifica una cuenta de ejecución y desea que PowerShell use las credenciales del usuario que se conecta para ejecutar comandos en el servidor remoto.</span><span class="sxs-lookup"><span data-stu-id="ad81c-159">**Pass-thru credentials** are used when you do not specify a run as account and want PowerShell to use the connecting user's credential to run commands on the remote server.</span></span>
<span data-ttu-id="ad81c-160">Esta configuración *no* se recomienda para JEA, ya que requeriría conceder acceso directo al usuario que se conecta a grupos de administración con privilegios.</span><span class="sxs-lookup"><span data-stu-id="ad81c-160">This configuration is *not* recommended for JEA as it would require you to grant the connecting user direct access to privileged management groups.</span></span>
<span data-ttu-id="ad81c-161">Si el usuario que se conecta ya tiene privilegios de administrador, puede evitar JEA por completo y administrar el sistema a través de otro medio sin restricciones.</span><span class="sxs-lookup"><span data-stu-id="ad81c-161">If the connecting user already has admin privileges, they can avoid JEA altogether and manage the system via other, unconstrained means.</span></span>
<span data-ttu-id="ad81c-162">Para obtener más información, consulte la sección siguiente en la que se detalla que [JEA no protege frente a administradores](#jea-does-not-protect-against-admins).</span><span class="sxs-lookup"><span data-stu-id="ad81c-162">See the section below on how [JEA does not protect against admins](#jea-does-not-protect-against-admins) for more information.</span></span>

<span data-ttu-id="ad81c-163">Las **cuentas de ejecución estándar** le permiten especificar cualquier cuenta de usuario en la que se ejecutará toda la sesión de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ad81c-163">**Standard run as accounts** allow you to specify any user account under which the entire PowerShell session will run.</span></span>
<span data-ttu-id="ad81c-164">Se trata de una distinción importante, ya que una configuración de sesión establecida para usar una cuenta de ejecución fija (con el parámetro `-RunAsCredential`) no es compatible con JEA.</span><span class="sxs-lookup"><span data-stu-id="ad81c-164">This is an important distinction, because a session configuration set to use a fixed run as account (with the `-RunAsCredential` parameter) is not JEA-aware.</span></span>
<span data-ttu-id="ad81c-165">Esto significa que las definiciones de rol ya no funcionan según lo previsto, y a cada usuario autorizado para tener acceso al punto de conexión se le asignará el mismo rol.</span><span class="sxs-lookup"><span data-stu-id="ad81c-165">That means that role definitions no longer function as expected, and every user authorized to access the endpoint will be assigned the same role.</span></span>

<span data-ttu-id="ad81c-166">No conviene usar el elemento RunAsCredential en un punto de conexión de JEA, ya que la dificultad de seguir las acciones hasta usuarios específicos y la falta de compatibilidad para asignar usuarios a roles es importante.</span><span class="sxs-lookup"><span data-stu-id="ad81c-166">You should not use a RunAsCredential on a JEA endpoint because of the difficulty in tracing actions back to specific users and the lack of support for mapping users to roles.</span></span>

## <a name="winrm-endpoint-acl"></a><span data-ttu-id="ad81c-167">ACL de punto de conexión de WinRM</span><span class="sxs-lookup"><span data-stu-id="ad81c-167">WinRM Endpoint ACL</span></span>

<span data-ttu-id="ad81c-168">Al igual que con los puntos de conexión de comunicación remota de PowerShell normales, cada punto de conexión de JEA tiene una lista de control de acceso (ACL) independiente establecida en la configuración de WinRM que controla quién se puede autenticar con el punto de conexión de JEA.</span><span class="sxs-lookup"><span data-stu-id="ad81c-168">As with regular PowerShell remoting endpoints, each JEA endpoint has a separate access control list (ACL) set in the WinRM configuration that controls who can authenticate with the JEA endpoint.</span></span>
<span data-ttu-id="ad81c-169">Si no se ha configurado correctamente, es posible que los usuarios de confianza no puedan tener acceso al punto de conexión de JEA, o bien que puedan hacerlo otros usuarios que no sean de confianza.</span><span class="sxs-lookup"><span data-stu-id="ad81c-169">If improperly configured, trusted users may not be able to access the JEA endpoint and/or untrusted users may gain access.</span></span>
<span data-ttu-id="ad81c-170">En cambio, la ACL de WinRM no afecta a la asignación de usuarios a roles de JEA.</span><span class="sxs-lookup"><span data-stu-id="ad81c-170">The WinRM ACL does not, however, affect the mapping of users to JEA roles.</span></span>
<span data-ttu-id="ad81c-171">Esta se controla mediante el campo *RoleDefinitions* del archivo de configuración de sesión que se ha registrado en el sistema.</span><span class="sxs-lookup"><span data-stu-id="ad81c-171">That is controlled by the *RoleDefinitions* field in the session configuration file that was registered on the system.</span></span>

<span data-ttu-id="ad81c-172">De manera predeterminada, al registrar un punto de conexión de JEA mediante un archivo de configuración de sesión y una o varias funcionalidades de rol, la ACL de WinRM se configurará para permitir que todos los usuarios asignados a uno o varios roles tengan acceso al punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="ad81c-172">By default, when you register a JEA endpoint using a session configuration file and one or more role capabilities, the WinRM ACL will be configured to allow all users mapping to one or more roles access to the endpoint.</span></span>
<span data-ttu-id="ad81c-173">Por ejemplo, una sesión de JEA configurada con los comandos siguientes concederá acceso total a *CONTOSO\JEA\_Lev1* y *CONTOSO\JEA\_Lev2*.</span><span class="sxs-lookup"><span data-stu-id="ad81c-173">For example, a JEA session configured using the following commands will grant full access to *CONTOSO\JEA\_Lev1* and *CONTOSO\JEA\_Lev2*.</span></span>

```powershell
$roles = @{ 'CONTOSO\JEA_Lev1' = 'Lev1Role'; 'CONTOSO\JEA_Lev2' = 'Lev2Role' }
New-PSSessionConfigurationFile -Path '.\jea.pssc' -SessionType RestrictedRemoteServer -RoleDefinitions $roles -RunAsVirtualAccount
Register-PSSessionConfiguration -Path '.\jea.pssc' -Name 'MyJEAEndpoint'
```

<span data-ttu-id="ad81c-174">Puede auditar los permisos de usuario con el cmdlet [Get-PSSessionConfiguration](https://msdn.microsoft.com/en-us/powershell/reference/5.1/microsoft.powershell.core/get-pssessionconfiguration).</span><span class="sxs-lookup"><span data-stu-id="ad81c-174">You can audit user permissions with the [Get-PSSessionConfiguration](https://msdn.microsoft.com/en-us/powershell/reference/5.1/microsoft.powershell.core/get-pssessionconfiguration) cmdlet.</span></span>

```powershell
PS C:\> Get-PSSessionConfiguration -Name 'MyJEAEndpoint' | Select-Object Permission

Permission
----------
CONTOSO\JEA_Lev1 AccessAllowed
CONTOSO\JEA_Lev2 AccessAllowed
```

<span data-ttu-id="ad81c-175">Para cambiar los usuarios que tienen acceso, ejecute `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -ShowSecurityDescriptorUI` para obtener un aviso interactivo o `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -SecurityDescriptorSddl <SDDL string>` para actualizar los permisos.</span><span class="sxs-lookup"><span data-stu-id="ad81c-175">To change which users have access, run either `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -ShowSecurityDescriptorUI` for an interactive prompt or `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -SecurityDescriptorSddl <SDDL string>` to update the permissions.</span></span>
<span data-ttu-id="ad81c-176">Los usuarios necesitan al menos *derechos de invocación* para tener acceso al punto de conexión de JEA.</span><span class="sxs-lookup"><span data-stu-id="ad81c-176">Users need at least *Invoke* rights to access the JEA endpoint.</span></span>

<span data-ttu-id="ad81c-177">Si se les concede acceso a otros usuarios al punto de conexión de JEA pero no entran dentro de ninguno de los roles definidos en el archivo de configuración de sesión, podrán iniciar una sesión de JEA, pero solo con acceso a los cmdlets predeterminados.</span><span class="sxs-lookup"><span data-stu-id="ad81c-177">If additional users are granted access to the JEA endpoint but do not fall into any of the roles defined in the session configuration file, they will be able to start a JEA session but only have access to the default cmdlets.</span></span>
<span data-ttu-id="ad81c-178">Puede auditar los permisos de usuario en un punto de conexión de JEA ejecutando `Get-PSSessionCapability`.</span><span class="sxs-lookup"><span data-stu-id="ad81c-178">You can audit user permissions in a JEA endpoint by running `Get-PSSessionCapability`.</span></span>
<span data-ttu-id="ad81c-179">Consulte el artículo [Auditoría y creación de informes en JEA](audit-and-report.md) para obtener más información sobre la auditoría y los comandos a los que tiene acceso un usuario en un punto de conexión de JEA.</span><span class="sxs-lookup"><span data-stu-id="ad81c-179">Check out the [Auditing and Reporting on JEA](audit-and-report.md) article for more information about auditing which commands a user has access to in a JEA endpoint.</span></span>

## <a name="least-privilege-roles"></a><span data-ttu-id="ad81c-180">Roles con privilegios mínimos</span><span class="sxs-lookup"><span data-stu-id="ad81c-180">Least privilege roles</span></span>

<span data-ttu-id="ad81c-181">Al diseñar roles de JEA, es importante recordar que la cuenta de servicio administrada de grupo o virtual que se ejecuta en segundo plano a menudo tiene acceso sin restricciones para administrar el equipo local.</span><span class="sxs-lookup"><span data-stu-id="ad81c-181">When designing JEA roles, it is important to remember that the virtual or group managed service account running behind the scenes often has unrestricted access to manage the local machine.</span></span>
<span data-ttu-id="ad81c-182">Las funcionalidades de rol de JEA ayudan a restringir para qué se puede usar esa cuenta al limitar los comandos y las aplicaciones que se pueden ejecutar con ese contexto privilegiado.</span><span class="sxs-lookup"><span data-stu-id="ad81c-182">JEA role capabilities help restrict what that account can be used for by limiting the commands and applications that can be run using that privileged context.</span></span>
<span data-ttu-id="ad81c-183">Los roles diseñados de manera incorrecta pueden permitir que se ejecuten comandos peligrosos que autoricen a un usuario a salir de los límites de JEA u obtener acceso a información confidencial.</span><span class="sxs-lookup"><span data-stu-id="ad81c-183">Improperly designed roles can allow dangerous commands to run that may allow a user to break out of the JEA boundaries or obtain access to sensitive information.</span></span>

<span data-ttu-id="ad81c-184">Por ejemplo, observe la siguiente entrada de funcionalidad de rol:</span><span class="sxs-lookup"><span data-stu-id="ad81c-184">For example, consider the following role capability entry:</span></span>

```powershell
@{
    VisibleCmdlets = 'Microsoft.PowerShell.Management\*-Process'
}
```

<span data-ttu-id="ad81c-185">Esta funcionalidad de rol permite a los usuarios ejecutar cualquier cmdlet de PowerShell con el nombre "Process" desde el módulo Microsoft.PowerShell.Management.</span><span class="sxs-lookup"><span data-stu-id="ad81c-185">This role capability allows users to run any PowerShell cmdlet with the noun "Process" from the Microsoft.PowerShell.Management module.</span></span>
<span data-ttu-id="ad81c-186">Es posible que los usuarios necesiten tener acceso a cmdlets como `Get-Process` para comprender las aplicaciones que se ejecutan en el sistema y `Stop-Process` para eliminar cualquier aplicación bloqueada.</span><span class="sxs-lookup"><span data-stu-id="ad81c-186">Users may need to access cmdlets like `Get-Process` to understand what applications are running on the system and `Stop-Process` to kill any hung applications.</span></span>
<span data-ttu-id="ad81c-187">En cambio, esta entrada también permite `Start-Process`, que se puede usar para iniciar un programa arbitrario con permisos de administrador total.</span><span class="sxs-lookup"><span data-stu-id="ad81c-187">However, this entry also allows `Start-Process`, which can be used to start up an arbitrary program with full administrator permissions.</span></span>
<span data-ttu-id="ad81c-188">El programa no tiene que estar instalado de forma local en el sistema, por lo que alguien ajeno podría simplemente iniciar un programa en un recurso compartido de archivos que proporcione al usuario que se conecta privilegios de administrador local, ejecute malware, etc.</span><span class="sxs-lookup"><span data-stu-id="ad81c-188">The program doesn't need to be installed locally on the system, so an adversary could simply start a program on a file share that gives the connecting user local admin privileges, runs malware, and more.'</span></span>

<span data-ttu-id="ad81c-189">Una versión más segura de esta misma funcionalidad de rol tendría el siguiente aspecto:</span><span class="sxs-lookup"><span data-stu-id="ad81c-189">A more secure version of this same role capability would look like:</span></span>

```powershell
@{
    VisibleCmdlets = 'Microsoft.PowerShell.Management\Get-Process', 'Microsoft.PowerShell.Management\Stop-Process'
}
```

<span data-ttu-id="ad81c-190">Evite usar caracteres comodín en las funcionalidades de rol y asegúrese de [auditar los permisos de usuario efectivos](audit-and-report.md#check-effective-rights-for-a-specific-user) con regularidad para comprender los comandos a los que tiene acceso un usuario.</span><span class="sxs-lookup"><span data-stu-id="ad81c-190">Avoid using wildcards in role capabilities, and be sure to [audit effective user permissions](audit-and-report.md#check-effective-rights-for-a-specific-user) regularly to understand which commands a user has access to.</span></span>

## <a name="jea-does-not-protect-against-admins"></a><span data-ttu-id="ad81c-191">JEA no protege frente a administradores</span><span class="sxs-lookup"><span data-stu-id="ad81c-191">JEA does not protect against admins</span></span>

<span data-ttu-id="ad81c-192">Uno de los principios básicos de JEA es que permite a los usuarios que no son administradores realizar *algunas* tareas administrativas.</span><span class="sxs-lookup"><span data-stu-id="ad81c-192">One of the core principles of JEA is that it allows non-admins to perform *some* admin tasks.</span></span>
<span data-ttu-id="ad81c-193">JEA no protege frente a aquellos que ya tengan privilegios de administrador.</span><span class="sxs-lookup"><span data-stu-id="ad81c-193">JEA does not protect against those who already have administrator privileges.</span></span>
<span data-ttu-id="ad81c-194">Los usuarios que pertenezcan a los grupos "administradores de dominio", "administradores locales" u otros con muchos privilegios en su entorno podrán eludir las protecciones de JEA iniciando sesión en el equipo por otros medios.</span><span class="sxs-lookup"><span data-stu-id="ad81c-194">Users who belong "domain admins," "local admins," or other highly privileged groups in your environment will still be able to get around JEA's protections by signing into the machine via another means.</span></span>
<span data-ttu-id="ad81c-195">Por ejemplo, pueden iniciar sesión con RDP, usar consolas remotas de MMC o conectarse a puntos de conexión de PowerShell sin restricciones.</span><span class="sxs-lookup"><span data-stu-id="ad81c-195">They could, for example, sign in with RDP, use remote MMC consoles, or connect to unconstrained PowerShell endpoints.</span></span>
<span data-ttu-id="ad81c-196">Los administradores locales del sistema también pueden modificar las configuraciones de JEA para permitir que usuarios adicionales administren el sistema o cambien una funcionalidad de rol para ampliar el ámbito de lo que puede realizar un usuario en su sesión de JEA.</span><span class="sxs-lookup"><span data-stu-id="ad81c-196">Local admins on the system can also modify JEA configurations to allow additional users to manage the system or change a role capability to extend the scope of what a user can do in their JEA session.</span></span>
<span data-ttu-id="ad81c-197">Por tanto, es importante evaluar los permisos extendidos de los usuarios de JEA para ver si hay otras formas de obtener acceso con privilegios al sistema.</span><span class="sxs-lookup"><span data-stu-id="ad81c-197">It is therefore important to evaluate your JEA users' extended permissions to see if there are other ways they could gain privileged access to the system.</span></span>

<span data-ttu-id="ad81c-198">Un procedimiento común es usar JEA para realizar el mantenimiento diario habitual y tener una solución de administración de acceso con privilegios "Just-In-Time" que permita que los usuarios se conviertan de forma temporal en administradores locales en situaciones de emergencia.</span><span class="sxs-lookup"><span data-stu-id="ad81c-198">A common practice is to use JEA for regular day-to-day maintenance and have a "just in time" privileged access management solution allow users to temporarily become local admins in emergency situations.</span></span>
<span data-ttu-id="ad81c-199">Esto ayuda a garantizar que los usuarios no sean administradores de forma permanente en el sistema, pero pueden obtener esos derechos si, y solo cuando, completan un flujo de trabajo que documente su uso de estos permisos.</span><span class="sxs-lookup"><span data-stu-id="ad81c-199">This helps ensure users are not permanent admins on the system, but can get those rights if, and only when, they complete a workflow that documents their use of those permissions.</span></span>

